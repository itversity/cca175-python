
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Getting Started &#8212; My Jupyter Book</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basic Transformations" href="02_basic_transformations.html" />
    <link rel="prev" title="CCA 175 - Spark and Hadoop Developer - Python" href="../spark_sql.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">My Jupyter Book</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../spark_sql.html">
   CCA 175 - Spark and Hadoop Developer - Python
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_basic_transformations.html">
   Basic Transformations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_basic_ddl_and_dml.html">
   Basic DDL and DML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_dml_and_partitioning.html">
   DML and Partitioning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_predefined_functions.html">
   Pre-defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_windowing_functions.html">
   Windowing Functions
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/spark-sql/01_getting_started.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/spark-sql/01_getting_started.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview-of-spark-documentation">
   Overview of Spark Documentation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#launching-and-using-spark-sql">
   Launching and Using Spark SQL
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview-of-spark-sql-properties">
   Overview of Spark SQL Properties
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-os-commands-using-spark-sql">
   Running OS Commands using Spark SQL
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#understanding-warehouse-directory">
   Understanding Warehouse Directory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managing-spark-metastore-databases">
   Managing Spark Metastore Databases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managing-spark-metastore-tables">
   Managing Spark Metastore Tables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieve-metadata-of-tables">
   Retrieve Metadata of Tables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#role-of-spark-or-hive-metastore">
   Role of Spark or Hive Metastore
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-getting-started-with-spark-sql">
   Exercise - Getting Started with Spark SQL
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Let us get started to get into Spark SQL. In this module we will see how to launch and use Spark SQL.</p>
<div class="cell tag_remove-input docutils container">
</div>
<ul class="simple">
<li><p>Overview of Spark Documentation</p></li>
<li><p>Launching and Using Spark SQL</p></li>
<li><p>Overview of Spark SQL Properties</p></li>
<li><p>Running OS Commands using Spark SQL</p></li>
<li><p>Understanding Warehouse Directory</p></li>
<li><p>Managing Spark Metastore Databases</p></li>
<li><p>Managing Spark Metastore Tables</p></li>
<li><p>Retrieve Metadata of Tables</p></li>
<li><p>Role of Spark or Hive Metastore</p></li>
</ul>
<div class="section" id="overview-of-spark-documentation">
<h2>Overview of Spark Documentation<a class="headerlink" href="#overview-of-spark-documentation" title="Permalink to this headline">¶</a></h2>
<p>Let us go through the details related to Spark Documentation. It is very important for you to get comfortable with Spark Documentation if you are aspiring for open book certification exams like CCA 175.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="nc">HTML</span>
<span class="o">&lt;</span><span class="n">iframe</span> <span class="n">width</span><span class="o">=</span><span class="s">&quot;560&quot;</span> <span class="n">height</span><span class="o">=</span><span class="s">&quot;315&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;https://www.youtube.com/embed/_gAD1tdxoKw?rel=0&amp;amp;controls=0&amp;amp;showinfo=0&quot;</span> <span class="n">frameborder</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="n">allowfullscreen</span><span class="o">&gt;&lt;/</span><span class="n">iframe</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Click <a class="reference external" href="https://spark.apache.org/docs/latest/sql-programming-guide.html">here</a> to go to latest Spark SQL and Data Frames documentation.</p></li>
<li><p>We typically get documentation for latest version.</p></li>
<li><p>We can replace <strong>latest</strong> in the URL with the version of Spark to get specific version’s official documentation.</p></li>
<li><p>Also we have resources provided by <strong>databricks</strong>.</p></li>
</ul>
</div>
<div class="section" id="launching-and-using-spark-sql">
<h2>Launching and Using Spark SQL<a class="headerlink" href="#launching-and-using-spark-sql" title="Permalink to this headline">¶</a></h2>
<p>Let us understand how to launch Spark SQL CLI.</p>
<ul class="simple">
<li><p>Logon to the gateway node of the cluster.</p></li>
<li><p>We have 2 versions of Spark in our labs. One can use <code class="docutils literal notranslate"><span class="pre">spark-sql</span></code> to launch Spark SQL using 1.6.x and <code class="docutils literal notranslate"><span class="pre">spark2-sql</span></code> to launch Spark SQL using 2.3.x.</p></li>
<li><p>Launch Spark SQL CLI using <code class="docutils literal notranslate"><span class="pre">spark-sql</span></code>. In clustered mode we might have to add additional arguments. For example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>spark2-sql \
    --master yarn \
    --conf spark.ui.port=0 \
    --conf spark.sql.warehouse.dir=/user/${USER}/warehouse
</pre></div>
</div>
<ul class="simple">
<li><p>One can get help using <code class="docutils literal notranslate"><span class="pre">spark-sql</span> <span class="pre">--help</span></code></p></li>
<li><p>For e. g.: we can use <code class="docutils literal notranslate"><span class="pre">spark-sql</span> <span class="pre">--database</span> <span class="pre">training_retail</span></code> to connect to specific database. Here is the example in clustered mode.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>spark2-sql \
    --master yarn \
    --conf spark.ui.port=0 \
    --conf spark.sql.warehouse.dir=/user/${USER}/warehouse \
    --database ${USER}_retail
</pre></div>
</div>
<ul class="simple">
<li><p>Spark SQL CLI will be launched and will be connected to <strong>${USER}_retail</strong> database.</p></li>
<li><p>We can validate to which database we are connected to using <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">current_database()</span></code></p></li>
</ul>
</div>
<div class="section" id="overview-of-spark-sql-properties">
<h2>Overview of Spark SQL Properties<a class="headerlink" href="#overview-of-spark-sql-properties" title="Permalink to this headline">¶</a></h2>
<p>Let us understand details about Spark SQL properties which control Spark SQL run time environment.</p>
<ul class="simple">
<li><p>Spark SQL inherits properties defined for Spark. There are some Spark SQL related properties as well and these are applicable even for Data Frames.</p></li>
<li><p>We can review these properties using Management Tools such as <strong>Ambari</strong> or <strong>Cloudera Manager Web UI</strong></p></li>
<li><p>Spark run time behavior is controlled by HDFS Properties files, YARN Properties files, Hive Properties files etc in those clusters where Spark is integrated with Hadoop and Hive.</p></li>
<li><p>We can get all the properties using <code class="docutils literal notranslate"><span class="pre">SET;</span></code> in Spark SQL CLI</p></li>
</ul>
<p>Let us review some important properties in Spark SQL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">warehouse</span><span class="o">.</span><span class="n">dir</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">catalogImplementation</span>
</pre></div>
</div>
<ul class="simple">
<li><p>We can review the current value using <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">spark.sql.warehouse.dir;</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">spark</span> <span class="o">=</span> <span class="nc">SparkSession</span><span class="o">.</span>
    <span class="n">builder</span><span class="o">.</span>
    <span class="n">config</span><span class="o">(</span><span class="s">&quot;spark.ui.port&quot;</span><span class="o">,</span> <span class="s">&quot;0&quot;</span><span class="o">).</span>
    <span class="n">config</span><span class="o">(</span><span class="s">&quot;spark.sql.warehouse.dir&quot;</span><span class="o">,</span> <span class="s">&quot;/user/itversity/warehouse&quot;</span><span class="o">).</span>
    <span class="n">enableHiveSupport</span><span class="o">.</span>
    <span class="n">master</span><span class="o">(</span><span class="s">&quot;yarn&quot;</span><span class="o">).</span>
    <span class="n">appName</span><span class="o">(</span><span class="s">&quot;Getting Started - Spark SQL&quot;</span><span class="o">).</span>
    <span class="n">getOrCreate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SET</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SET</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">warehouse</span><span class="o">.</span><span class="n">dir</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Properties with default values does not show up as part of <code class="docutils literal notranslate"><span class="pre">SET</span></code> command. But we can check and overwrite the values - for example</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SET</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">shuffle</span><span class="o">.</span><span class="n">partitions</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can overwrite property by setting value using the same <strong>SET</strong> command, eg:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SET</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">shuffle</span><span class="o">.</span><span class="n">partitions</span><span class="k">=</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="running-os-commands-using-spark-sql">
<h2>Running OS Commands using Spark SQL<a class="headerlink" href="#running-os-commands-using-spark-sql" title="Permalink to this headline">¶</a></h2>
<p>Let us understand how to run OS commands using Spark SQL CLI.</p>
<ul class="simple">
<li><p>We can run OS commands using <strong>!</strong> at the beginning.</p>
<ul>
<li><p>Listing local Files <code class="docutils literal notranslate"><span class="pre">!ls</span> <span class="pre">-ltr;</span></code></p></li>
<li><p>Listing HDFS Files <code class="docutils literal notranslate"><span class="pre">!hdfs</span> <span class="pre">dfs</span> <span class="pre">-ls</span> <span class="pre">/public/retail_db;</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>

<span class="s">&quot;ls -ltr&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>

<span class="s">&quot;hdfs dfs -ls /public/retail_db&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="understanding-warehouse-directory">
<h2>Understanding Warehouse Directory<a class="headerlink" href="#understanding-warehouse-directory" title="Permalink to this headline">¶</a></h2>
<p>Let us go through the details related to Spark Metastore Warehouse Directory.</p>
<ul class="simple">
<li><p>A Database in Spark SQL is nothing but directory in underlying file system like HDFS.</p></li>
<li><p>A Spark Metastore Table is nothing but directory in underlying file systems like HDFS.</p></li>
<li><p>A Partition of Spark Metastore Table is nothing but directory in underlying file systems like HDFS under table.</p></li>
<li><p>Warehouse Directory is the base directory where directories related to databases, tables go by default.</p></li>
<li><p>It is controlled by <code class="docutils literal notranslate"><span class="pre">spark.sql.warehouse.dir</span></code>. You can get the value by saying <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">spark.sql.warehouse.dir;</span></code></p></li>
</ul>
<blockquote>
<div><p><span style="color:red">Do not overwrite this property Spark SQL CLI. It will not have any effect.</span></p>
</div></blockquote>
<ul class="simple">
<li><p>Underlying directory for a database will have <strong>.db</strong> extension.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SET</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">warehouse</span><span class="o">.</span><span class="n">dir</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="managing-spark-metastore-databases">
<h2>Managing Spark Metastore Databases<a class="headerlink" href="#managing-spark-metastore-databases" title="Permalink to this headline">¶</a></h2>
<p>Let us undestand how to manage Spark Metastore Databases.</p>
<ul class="simple">
<li><p>Make a habit of reviewing Language Manual.</p></li>
<li><p>We can create database using <strong>CREATE DATABASE</strong> Command.</p></li>
<li><p>For e. g.: <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">itversity_demo;</span></code></p></li>
<li><p>If the database exists it will fail. If you want to ignore with out throwing error you can use <strong>IF NOT EXISTS</strong></p></li>
<li><p>e. g.: <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span> <span class="pre">itversity_demo;</span></code></p></li>
<li><p>We can list the databases using <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">databases;</span></code></p></li>
<li><p>Spark Metastore is multi tenant database. To switch to a database, you can use <strong>USE</strong> Command. e. g.: <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">itversity_demo;</span></code></p></li>
<li><p>We can drop empty database by using <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">DATABASE</span> <span class="pre">itversity_demo;</span></code>.</p></li>
<li><p>Add cascade to drop all the tables and then the database <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">DATABASE</span> <span class="pre">itversity_demo</span> <span class="pre">CASCADE;</span></code>.</p></li>
<li><p>We can also specify location while creating the database - <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">itversity_demo</span> <span class="pre">LOCATION</span> <span class="pre">'/user/itversity/custom/itversity_demo.db'</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DROP</span> <span class="nc">DATABASE</span> <span class="nc">IF</span> <span class="nc">EXISTS</span> <span class="n">itversity_demo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">DATABASE</span> <span class="n">itversity_demo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">DATABASE</span> <span class="n">itversity_demo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">DATABASE</span> <span class="nc">IF</span> <span class="nc">NOT</span> <span class="nc">EXISTS</span> <span class="n">itversity_demo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SHOW</span> <span class="n">databases</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SELECT</span> <span class="n">current_database</span><span class="o">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">USE</span> <span class="n">itversity_demo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SELECT</span> <span class="n">current_database</span><span class="o">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">username</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperty</span><span class="o">(</span><span class="s">&quot;user.name&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>
<span class="s">s&quot;hdfs dfs -ls /user/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">/warehouse/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">_demo.db&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">TABLE</span> <span class="n">table_demo</span> <span class="o">(</span><span class="n">i</span> <span class="nc">INT</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>
<span class="s">s&quot;hdfs dfs -ls /user/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">/warehouse/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">_demo.db&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DROP</span> <span class="nc">DATABASE</span> <span class="n">itversity_demo</span> <span class="nc">CASCADE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>
<span class="s">s&quot;hdfs dfs -ls /user/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">/warehouse/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">_demo.db&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span>%%sql

CREATE DATABASE itversity_demo LOCATION &#39;/user/itversity/custom/itversity_demo.db&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>
<span class="s">s&quot;hdfs dfs -ls /user/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">/custom&quot;</span><span class="o">!</span> <span class="c1">// Directory will be created if it does not exists</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">sys.process._</span>
<span class="s">s&quot;hdfs dfs -ls /user/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">/custom/</span><span class="si">${</span><span class="n">username</span><span class="si">}</span><span class="s">_demo.db&quot;</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="managing-spark-metastore-tables">
<h2>Managing Spark Metastore Tables<a class="headerlink" href="#managing-spark-metastore-tables" title="Permalink to this headline">¶</a></h2>
<p>Let us create our first Spark Metastore table. We will also have a look into how to list the tables.</p>
<ul class="simple">
<li><p>We will get into details related to DDL Commands at a later point in time.</p></li>
<li><p>For now we will just create our first table. We will get into the details about creating tables as part of subsequent sections.</p></li>
</ul>
<blockquote>
<div><p><span style="color:red">Use your OS username as prefix for the databases, if you are using our labs</span></p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SELECT</span> <span class="n">current_database</span><span class="o">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DROP</span> <span class="nc">DATABASE</span> <span class="n">itversity_retail</span> <span class="nc">CASCADE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">DATABASE</span> <span class="n">itversity_retail</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">USE</span> <span class="n">itversity_retail</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">CREATE</span> <span class="nc">TABLE</span> <span class="n">orders</span> <span class="o">(</span>
  <span class="n">order_id</span> <span class="nc">INT</span><span class="o">,</span>
  <span class="n">order_date</span> <span class="nc">STRING</span><span class="o">,</span>
  <span class="n">order_customer_id</span> <span class="nc">INT</span><span class="o">,</span>
  <span class="n">order_status</span> <span class="nc">STRING</span>
<span class="o">)</span> <span class="nc">ROW</span> <span class="nc">FORMAT</span> <span class="nc">DELIMITED</span> <span class="nc">FIELDS</span> <span class="nc">TERMINATED</span> <span class="nc">BY</span> <span class="sc">&#39;,&#39;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can list the tables using <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">tables;</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SHOW</span> <span class="n">tables</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can also drop the table using <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> command. We will get into more details at a later point in time.</p></li>
<li><p>We can also truncate the managed tables using <code class="docutils literal notranslate"><span class="pre">TRUNCATE</span> <span class="pre">TABLE</span></code> command.</p></li>
</ul>
</div>
<div class="section" id="retrieve-metadata-of-tables">
<h2>Retrieve Metadata of Tables<a class="headerlink" href="#retrieve-metadata-of-tables" title="Permalink to this headline">¶</a></h2>
<p>As the table is created, let us understand how to get the metadata of a table.</p>
<ul class="simple">
<li><p>We can get metadata of Hive Tables using several commands.</p>
<ul>
<li><p>DESCRIBE - e.g.: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">orders;</span></code></p></li>
<li><p>DESCRIBE EXTENDED - e.g.: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">EXTENDED</span> <span class="pre">orders;</span></code></p></li>
<li><p>DESCRIBE FORMATTED - e.g.: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">FORMATTED</span> <span class="pre">orders;</span></code></p></li>
</ul>
</li>
<li><p><strong>DESCRIBE</strong> will give only field names and data types.</p></li>
<li><p><strong>DESCRIBE EXTENDED</strong> will give all the metadata, but not in readable format in Hive. It is same as <strong>DESCRIBE FORMATTED</strong> in Spark SQL.</p></li>
<li><p><strong>DESCRIBE FORMATTED</strong> will give metadata in readable format.</p></li>
</ul>
<p><strong>As the output is truncated using Jupyter, we will actually see the details using <code class="docutils literal notranslate"><span class="pre">spark-sql</span></code></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SELECT</span> <span class="n">current_database</span><span class="o">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">USE</span> <span class="n">itversity_retail</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">SHOW</span> <span class="n">tables</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DESCRIBE</span> <span class="n">orders</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DESCRIBE</span> <span class="nc">EXTENDED</span> <span class="n">orders</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>

<span class="nc">DESCRIBE</span> <span class="nc">FORMATTED</span> <span class="n">orders</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="role-of-spark-or-hive-metastore">
<h2>Role of Spark or Hive Metastore<a class="headerlink" href="#role-of-spark-or-hive-metastore" title="Permalink to this headline">¶</a></h2>
<p>Let us understand the role of Spark Metastore or Hive Metasore. We need to first understand details related to Metadata generated for Spark Metastore tables.</p>
<ul class="simple">
<li><p>When we create a Spark Metastore table, there is metadata associated with it.</p>
<ul>
<li><p>Table Name</p></li>
<li><p>Column Names and Data Types</p></li>
<li><p>Location</p></li>
<li><p>File Format</p></li>
<li><p>and more</p></li>
</ul>
</li>
<li><p>This metadata has to be stored some where so that Query Engines such as Spark SQL can access the information to serve our queries.</p></li>
</ul>
<p>Let us understand where the metadata is stored.</p>
<ul class="simple">
<li><p>Information is typically stored in relational database and it is called as metastore.</p></li>
<li><p>It is extensively used by Hive or Spark SQL engine for syntax and semantics check as well as execution of queries.</p></li>
<li><p>In our case it is stored in MySQL Database. Let us review the details by going through relevant properties.</p></li>
</ul>
</div>
<div class="section" id="exercise-getting-started-with-spark-sql">
<h2>Exercise - Getting Started with Spark SQL<a class="headerlink" href="#exercise-getting-started-with-spark-sql" title="Permalink to this headline">¶</a></h2>
<p>Let’s do a simple exercise to conclude this section.</p>
<ul class="simple">
<li><p>Launch Spark SQL (don’t use database) (use spark-sql command). Here is the script for our labs. In other environments, you can skip last line. I have also included commands to launch Spark using Scala or Python (for CCA 175 Certification purpose)</p></li>
</ul>
<p><strong>Using Spark SQL</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>spark2-sql \
    --master yarn \
    --conf spark.ui.port=0 \
    --conf spark.sql.warehouse.dir=/user/${USER}/warehouse
</pre></div>
</div>
<p><strong>Using Scala</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>spark2-shell \
    --master yarn \
    --conf spark.ui.port=0 \
    --conf spark.sql.warehouse.dir=/user/${USER}/warehouse
</pre></div>
</div>
<p><strong>Using Pyspark</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pyspark2 \
    --master yarn \
    --conf spark.ui.port=0 \
    --conf spark.sql.warehouse.dir=/user/${USER}/warehouse
</pre></div>
</div>
<ul class="simple">
<li><p>Create Database and exit (make sure to prefix database name with your OS username, e. g.: <strong>training_retail</strong> for OS user training)</p></li>
<li><p>Exit and launch connecting to your database</p></li>
<li><p>Create Table orders. You can use below script to create the table.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
  <span class="n">order_id</span> <span class="n">INT</span><span class="p">,</span>
  <span class="n">order_date</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">order_customer_id</span> <span class="n">INT</span><span class="p">,</span>
  <span class="n">order_status</span> <span class="n">STRING</span>
<span class="p">)</span> <span class="n">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="n">BY</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>List the tables</p></li>
<li><p>Describe the table and review the whole metadata</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "apache_toree_scala"
        },
        kernelOptions: {
            kernelName: "apache_toree_scala",
            path: "./spark-sql"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'apache_toree_scala'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../spark_sql.html" title="previous page">CCA 175 - Spark and Hadoop Developer - Python</a>
    <a class='right-next' id="next-link" href="02_basic_transformations.html" title="next page">Basic Transformations</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>